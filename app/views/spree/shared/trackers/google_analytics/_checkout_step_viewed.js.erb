<% if @order.present? && !@order.completed? %>
  <script>
    if (typeof gtag !== 'undefined') {
      gtag('event', 'checkout_progress', {
         checkout_step: '<%= (@order.checkout_steps.index(@order.state) + 1) %>',
        items: [
          <% @order.line_items.each do |line_item| %>
            <%= ga_line_item(line_item) %>,
          <% end %>
        ],

        coupon: '<%= @order.promo_code %>',
      });

      gtag('event', 'set_checkout_option', {
        'checkout_step': '<%= (@order.checkout_steps.index(@order.state) + 1) %>',
        'checkout_option': '<%= @order.state %>'
      });
    };
  </script>
<% end %>
